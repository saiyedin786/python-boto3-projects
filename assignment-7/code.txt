import json
import boto3

sns = boto3.client('sns')

SNS_TOPIC_ARN = "arn:aws:sns:ap-south-1:123456789012:DynamoDB-Update-Alert"

def lambda_handler(event, context):
    print("Received event:", json.dumps(event))

    for record in event['Records']:
        # Process only MODIFY events
        if record['eventName'] == 'MODIFY':
            old_image = record['dynamodb']['OldImage']
            new_image = record['dynamodb']['NewImage']

            message = (
                "DynamoDB Item Updated\n\n"
                f"Old Item:\n{json.dumps(old_image, indent=2)}\n\n"
                f"New Item:\n{json.dumps(new_image, indent=2)}"
            )

            response = sns.publish(
                TopicArn=SNS_TOPIC_ARN,
                Subject="DynamoDB Item Update Alert",
                Message=message
            )

            print("SNS notification sent:", response)

    return {
        'statusCode': 200,
        'body': 'Processed DynamoDB update event'
    }
